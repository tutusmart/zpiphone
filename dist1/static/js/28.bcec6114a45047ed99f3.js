webpackJsonp([28],{Gsba:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n={name:"ShowTeacherDetil",data:function(){return{title:"",showTimer:!1,showTeacher:!1,timeMode:"",currentDate:new Date,editIndex:"",minDate:"",maxDate:"",showData:[],teacherList:[],tempData:[],first:!0,ajaxDataConcat:""}},methods:{onClickLeft:function(){this.utils.goBack(this)},onClickRight:function(){var t=this;this.tempData.forEach(function(t){t.allotTimes=[]}),this.showData.forEach(function(e){e.edit||t.tempData.forEach(function(t){t.teacherId==e.teacherId&&t.allotTimes.push({endDate:e.endDate,startDate:e.startDate})})});var e=[];if(this.tempData.forEach(function(t){t.allotTimes.length>0&&e.push(t)}),e.length<=0)this.Toast("请至少添加一条带教时间");else{var a=[];this.ajaxDataConcat.forEach(function(t){var n=!0;if(e.forEach(function(e){t.teacherId==e.teacherId&&(n=!1)}),n){var i={allotTimes:[],cycleEndTime:e[0].cycleEndTime,cycleStartTime:e[0].cycleStartTime,departmentId:e[0].departmentId,normalDepartmentId:e[0].normalDepartmentId,studentId:e[0].studentId,teacherId:t.teacherId};a.push(i)}}),e=e.concat(a),this.utils.ajax({url:this.api.allotTeacher,data:{allotTeachers:e},method:"post",success:function(e){t.onClickLeft()}})}},returnHTML:function(t){return t.teacherName?t.teacherName:"请选择带教老师"},chooseDateStart:function(t,e,a){if(!this.showTimer){this.showTimer=!0,this.timeMode=e,this.editIndex=a;var n=this.$route.params.params;"startDate"==e?(this.currentDate=new Date(n.startDate.replace(/-/g,"/")),this.minDate=new Date(n.startDate.replace(/-/g,"/")),t.endDate?this.maxDate=new Date(t.endDate.replace(/-/g,"/")):this.maxDate=new Date(n.endDate.replace(/-/g,"/"))):(this.currentDate=new Date(n.endDate.replace(/-/g,"/")),this.maxDate=new Date(n.endDate.replace(/-/g,"/")),t.startDate?this.minDate=new Date(t.startDate.replace(/-/g,"/")):this.minDate=new Date(n.startDate.replace(/-/g,"/")))}},confirm:function(t){var e=this,a=t.getFullYear()+"-"+this.timeRule(t.getMonth(),"month")+"-"+this.timeRule(t.getDate()),n=new Date(a.replace(/-/g,"/")),i=!0;this.showData.forEach(function(t,a){var s=void 0,r=void 0;t.startDate&&t.endDate&&e.editIndex!=a&&!t.edit&&(s=new Date(t.startDate.replace(/-/g,"/")).getTime(),r=new Date(t.endDate.replace(/-/g,"/")).getTime(),n>=s&&n<=r&&(i=!1))}),i?(this.showData[this.editIndex][this.timeMode]=a,this.showTimer=!1):this.Toast("该时间区间已被选取")},chooseTeacher:function(t){this.showTeacher=!0,this.editIndex=t},onConfirm:function(t,e){this.showData[this.editIndex].teacherName=t.text,this.showData[this.editIndex].teacherId=t.teacherId,this.showTeacher=!1},timeRule:function(t,e){return"month"==e&&t++,t>9?t:"0"+t},cancel:function(){this.showTimer=!1,this.showTeacher=!1},edit:function(t){t.edit=!0},del:function(t){var e=[];this.showData.forEach(function(a,n){t!=n&&e.push(a)}),this.showData=e},suerTime:function(t){t.teacherName?t.startDate?t.endDate?(t.str=this.timeFormat(new Date(t.startDate.replace(/-/g,"/")))+"至"+this.timeFormat(new Date(t.endDate.replace(/-/g,"/"))),t.edit=!1):this.Toast("请选择结束时间"):this.Toast("请选择开始时间"):this.Toast("请选择带教老师")},addDate:function(){var t=!0;this.showData.forEach(function(e){e.edit&&(t=!1)}),t?this.showData.push({endDate:"",startDate:"",str:"",teacherId:"",teacherName:"",edit:!0,disEdit:!0}):this.Toast("请您先确认已设置带教")},loadData:function(t){var e=this;this.title=this.$route.params.params.name;var a=this.$route.params.params;a.currentPage=1,a.pageSize=100,a.selfDepartment=t,this.utils.ajax({url:this.api.pagingAllotTeacherList,data:a,method:"post",success:function(n){e.first&&(e.first=!1,e.loadData(!0));n.content.forEach(function(n){t?(e._data.tempData.push({studentId:a.studentId,cycleEndTime:a.endDate,cycleStartTime:a.startDate,normalDepartmentId:a.normalDepartmentId,departmentId:a.cycleDepartmentId,teacherId:n.teacherId}),e._data.teacherList.push({text:n.teacherName,teacherId:n.teacherId})):n.allotTimes.length>0&&n.allotTimes.forEach(function(t){e._data.showData.push({teacherName:n.teacherName,teacherId:n.teacherId,str:e.timeFormat(new Date(t.startDate.replace(/-/g,"/")))+"至"+e.timeFormat(new Date(t.endDate.replace(/-/g,"/"))),endDate:e.timeFormat(new Date(t.endDate.replace(/-/g,"/"))),startDate:e.timeFormat(new Date(t.startDate.replace(/-/g,"/"))),edit:!1,disEdit:n.selfDepartment})})}),e._data.ajaxDataConcat=e._data.showData}})},timeFormat:function(t){return t.getFullYear()+"-"+this.timeRule(t.getMonth(),"month")+"-"+this.timeRule(t.getDate())}},created:function(){this.$route.params.params&&this.loadData(!1)}},i={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("van-nav-bar",{staticClass:"header",attrs:{title:t.title,"right-text":"保存",fixed:"","left-arrow":""},on:{"click-right":t.onClickRight,"click-left":t.onClickLeft}}),t._v(" "),a("div",{staticClass:"layout_content"},[a("ul",t._l(t.showData,function(e,n){return a("li",[!e.edit&&e.disEdit?a("van-swipe-cell",{attrs:{"right-width":130}},[a("van-cell-group",[a("div",[a("span",[t._v("带教老师：")]),a("span",[t._v(t._s(e.teacherName))])]),t._v(" "),a("div",{staticClass:"font-color"},[a("span",[t._v("带教时间：")]),a("span",[t._v(t._s(e.str))])])]),t._v(" "),a("span",{staticClass:"btn btn-edit",attrs:{slot:"right"},on:{click:function(a){return t.edit(e)}},slot:"right"},[t._v("编辑")]),t._v(" "),a("span",{staticClass:"btn btn-del",attrs:{slot:"right"},on:{click:function(e){return t.del(n)}},slot:"right"},[t._v("删除")])],1):t._e(),t._v(" "),e.disEdit?t._e():a("van-cell-group",[a("div",[a("span",[t._v("带教老师：")]),a("span",[t._v(t._s(e.teacherName))])]),t._v(" "),a("div",{staticClass:"font-color"},[a("span",[t._v("带教时间：")]),a("span",[t._v(t._s(e.str))])])]),t._v(" "),e.edit?a("div",{staticClass:"edit"},[a("div",[a("div",[a("span",[t._v("带教老师：")]),a("span",{class:e.teacherName?"":"colorGrey",on:{click:function(e){return t.chooseTeacher(n)}}},[t._v(t._s(t.returnHTML(e)))])]),t._v(" "),a("div",[a("input",{attrs:{type:"text",readonly:"",placeholder:"请选择开始时间"},domProps:{value:e.startDate},on:{click:function(a){return t.chooseDateStart(e,"startDate",n)}}}),t._v(" "),a("span",[t._v("至")]),t._v(" "),a("input",{attrs:{type:"text",readonly:"",placeholder:"请选结束始时间"},domProps:{value:e.endDate},on:{click:function(a){return t.chooseDateStart(e,"endDate",n)}}})])]),t._v(" "),a("span",{staticClass:"btn-suer",on:{click:function(a){return t.suerTime(e)}}},[t._v("确认")])]):t._e()],1)}),0),t._v(" "),a("div",{staticClass:"addTime",on:{click:t.addDate}},[a("van-icon",{staticClass:"add",attrs:{name:"add"}}),t._v("添加带教老师")],1)]),t._v(" "),a("van-popup",{attrs:{position:"bottom",overlay:!0},model:{value:t.showTimer,callback:function(e){t.showTimer=e},expression:"showTimer"}},[a("van-datetime-picker",{attrs:{type:"date","min-date":t.minDate,"max-date":t.maxDate},on:{confirm:t.confirm,cancel:t.cancel},model:{value:t.currentDate,callback:function(e){t.currentDate=e},expression:"currentDate"}})],1),t._v(" "),a("van-popup",{attrs:{position:"bottom",overlay:!0},model:{value:t.showTeacher,callback:function(e){t.showTeacher=e},expression:"showTeacher"}},[a("van-picker",{attrs:{"show-toolbar":"",title:"选择带教老师",columns:t.teacherList},on:{cancel:t.cancel,confirm:t.onConfirm}})],1)],1)},staticRenderFns:[]};var s=a("VU/8")(n,i,!1,function(t){a("QuO6")},"data-v-6b740e04",null);e.default=s.exports},QuO6:function(t,e){}});
//# sourceMappingURL=28.bcec6114a45047ed99f3.js.map
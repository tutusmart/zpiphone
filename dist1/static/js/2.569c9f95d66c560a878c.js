webpackJsonp([2],{"/geI":function(t,i,n){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var s=n("woOf"),e=n.n(s),a={name:"SignIn",data:function(){return{curTime:"",departmentName:"",locationObj:{locationDetail:"正在获取当前位置",latitudeAndLongitude:""},signInList:[]}},methods:{onClickLeft:function(){this.utils.goBack(this)},onClickRight:function(){this.$router.push({name:"MonthlyCalendar"})},getSignInDetails:function(){var t=this;this.curTime=this.$store.state.timestamp.split(" ")[0],this.utils.ajax({method:"POST",url:this.api.signInDetails,success:function(i){t.departmentName=i.currentSchedulingResultNew.departmentName,i.schedulingResultNews.forEach(function(i){i.signIn=i.signInTime?t.utils.formatDate(i.signInTime,"HH:mm"):"",i.signOut=i.signOutTime?t.utils.formatDate(i.signOutTime,"HH:mm"):""}),t.signInList=i.schedulingResultNews}})},authority:function(t){var i=this;this.webApp.WebCallApp("positioningPoint",{},function(n){i.webApp.isInIOS()?n.result.state&&i.location(t):n.result.args.state&&i.location(t)})},location:function(t){var i=this;t&&(this.locationObj.locationDetail="正在更新位置..."),AMap.plugin("AMap.Geolocation",function(){var t=new AMap.Geolocation({enableHighAccuracy:!0,timeout:5e3,buttonOffset:new AMap.Pixel(10,20)});t.getCurrentPosition(),AMap.event.addListener(t,"complete",function(t){i.locationObj.locationDetail=t.formattedAddress,i.locationObj.latitudeAndLongitude=t.position.lat+","+t.position.lng,i.locationObj.flage=!0}),AMap.event.addListener(t,"error",function(t){i.locationObj.locationDetail="定位失败，请重新获取定位","Geolocation permission denied."===t.message&&(i.Toast("请开启定位权限"),i.locationObj.locationDetail="请开启定位权限"),i.locationObj.flage=!1})})},signInFn:function(t){var i=this;if(t.signInTime)this.Toast("已经签到");else{var n=e()({},{flag:1,id:t.id},this.locationObj);this.locationObj.flage?this.utils.ajax({url:this.api.saveSign,data:n,method:"POST",success:function(n){i.Toast("签到成功"),t.signInTime=n.signInTime,t.signIn=i.utils.formatDate(n.signInTime,"HH:mm")}}):this.Dialog.confirm({title:"温馨提示",message:"定位未获取成功，是否继续"}).then(function(){n.locationObj.locationDetail="",i.utils.ajax({url:i.api.saveSign,data:n,method:"POST",success:function(n){i.Toast("签到成功"),t.signInTime=n.signInTime,t.signIn=i.utils.formatDate(n.signInTime,"HH:mm")}})})}},signOutFn:function(t){var i=this;if(t.signInTime){var n=e()({},{flag:2,id:t.id},this.locationObj);this.locationObj.flage?this.utils.ajax({url:this.api.saveSign,data:n,method:"POST",success:function(n){console.log(n),i.Toast("签退成功"),t.signOutTime=n.signOutTime,t.signOut=i.utils.formatDate(n.signOutTime,"HH:mm")}}):this.Dialog.confirm({title:"温馨提示",message:"定位未获取成功，是否继续"}).then(function(){n.locationObj.locationDetail="",i.utils.ajax({url:i.api.saveSign,data:n,method:"POST",success:function(n){console.log(n),i.Toast("签退成功"),t.signOutTime=n.signOutTime,t.signOut=i.utils.formatDate(n.signOutTime,"HH:mm")}})})}else this.Toast("请先签到")}},created:function(){this.authority(),this.getSignInDetails()}},o={render:function(){var t=this,i=t.$createElement,n=t._self._c||i;return n("div",[n("van-nav-bar",{staticClass:"header",attrs:{title:"签到打卡","right-text":"考勤月历",fixed:"","left-arrow":""},on:{"click-left":t.onClickLeft,"click-right":t.onClickRight}}),t._v(" "),n("div",{staticClass:"layout_content"},[n("div",{staticClass:"sigin_head"},[n("van-row",[n("van-col",{staticClass:"tl van-ellipsis",attrs:{span:"12"}},[t._v(t._s(t.departmentName))]),t._v(" "),n("van-col",{staticClass:"tr",attrs:{span:"12"}},[t._v(t._s(t.curTime))])],1),t._v(" "),n("p",[t._v(t._s(t.locationObj.locationDetail))]),t._v(" "),n("span",{staticClass:"a",on:{click:function(i){return t.authority("res")}}},[t._v("更新定位")])],1),t._v(" "),n("div",{staticClass:"sigin_content"},[t.signInList.length?n("ul",t._l(t.signInList,function(i){return n("li",[n("van-row",[n("van-col",{attrs:{span:"4"}},[n("p",{staticClass:"sginTitle"},[t._v(t._s(i.dutyTypeVO.dutyType))])]),t._v(" "),n("van-col",{attrs:{span:"10"}},[n("div",{staticClass:"singBtn",class:i.signInTime?"singBorder":"noSingBorder",on:{click:function(n){return t.signInFn(i)}}},[i.signInTime?n("div",[n("div",{staticClass:"semicircleTitle"},[t._v("签到")]),t._v(" "),n("div",{staticClass:"semicircle"},[t._v(t._s(i.signIn))])]):n("div",{staticClass:"wholeCircle"},[n("div",{staticClass:"wholeCircleTitle"},[t._v("签到")])])])]),t._v(" "),n("van-col",{attrs:{span:"10"}},[n("div",{staticClass:"singBtn",class:i.signOutTime?"singBorder":"noSingBorder",on:{click:function(n){return t.signOutFn(i)}}},[i.signOutTime?n("div",[n("div",{staticClass:"semicircleTitle"},[t._v("签退")]),t._v(" "),n("div",{staticClass:"semicircle"},[t._v(t._s(i.signOut))])]):n("div",{staticClass:"wholeCircle"},[n("div",{staticClass:"wholeCircleTitle"},[t._v("签退")])])])])],1)],1)}),0):n("div",{staticClass:"gray center"},[t._v("暂无值班安排")])])])],1)},staticRenderFns:[]};var l=n("VU/8")(a,o,!1,function(t){n("xSq5")},"data-v-fc453fb4",null);i.default=l.exports},"1kS7":function(t,i){i.f=Object.getOwnPropertySymbols},NpIQ:function(t,i){i.f={}.propertyIsEnumerable},R4wc:function(t,i,n){var s=n("kM2E");s(s.S+s.F,"Object",{assign:n("To3L")})},To3L:function(t,i,n){"use strict";var s=n("lktj"),e=n("1kS7"),a=n("NpIQ"),o=n("sB3e"),l=n("MU5D"),c=Object.assign;t.exports=!c||n("S82l")(function(){var t={},i={},n=Symbol(),s="abcdefghijklmnopqrst";return t[n]=7,s.split("").forEach(function(t){i[t]=t}),7!=c({},t)[n]||Object.keys(c({},i)).join("")!=s})?function(t,i){for(var n=o(t),c=arguments.length,r=1,u=e.f,g=a.f;c>r;)for(var f,m=l(arguments[r++]),d=u?s(m).concat(u(m)):s(m),v=d.length,h=0;v>h;)g.call(m,f=d[h++])&&(n[f]=m[f]);return n}:c},V3tA:function(t,i,n){n("R4wc"),t.exports=n("FeBl").Object.assign},woOf:function(t,i,n){t.exports={default:n("V3tA"),__esModule:!0}},xSq5:function(t,i){}});
//# sourceMappingURL=2.569c9f95d66c560a878c.js.map
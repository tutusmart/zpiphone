webpackJsonp([45],{fEqK:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i={name:"EntryRegister",components:{ViewList:a("p2g1").a},data:function(){var t=this,e=this.utils.formatDate((new Date).getTime(),"yyyy-MM"),a=this.utils.formatDate((new Date).getTime(),"yyyy-MM").replace(/-/g,"/");return{active:0,timeShow:!1,descriptShow:!1,checkedTimeShow:!1,remark:"",checkInTime:new Date,startTime:e,startTimeShow:a,currentDate:new Date,currentPage:1,tabs:[{title:"待登记",loading:!1,finished:!1,error:!1,finishedText:"没有更多了",listObj:{list:[{field:"姓名：",name:"studentName",leftClass:"gray"},{field:"参培年份：",name:"traineeYear",leftClass:"gray"},{field:"专业：",name:"traineeMajorText",leftClass:"gray"},{field:"轮转科室：",name:"departmentName",leftClass:"gray"},{field:"入科时间：",name:"startTime",leftClass:"gray",render:function(e,a){return e[a]?t.utils.formatDate(e[a],"yyyy-MM-dd").replace(/-/g,"/"):""}}],click:function(e){0==t.active&&(e.selected=!e.selected)}},newList:[]},{title:"已登记",loading:!1,finished:!1,error:!1,finishedText:"没有更多了",listObj:{list:[{field:"姓名：",name:"studentName",leftClass:"gray"},{field:"参培年份：",name:"traineeYear",leftClass:"gray"},{field:"专业：",name:"traineeMajorText",leftClass:"gray"},{field:"轮转科室：",name:"departmentName",leftClass:"gray"},{field:"入科时间：",name:"startTime",leftClass:"gray",render:function(e,a){return e[a]?t.utils.formatDate(e[a],"yyyy-MM-dd").replace(/-/g,"/"):""}},{field:"备注：",name:"remark",leftClass:"gray"}],click:function(e){0==t.active&&(e.selected=!e.selected)}},newList:[]}]}},methods:{onClickLeft:function(){this.utils.goBack(this)},onLoad:function(){console.log("load---\x3e"),this.getData()},change:function(t,e){document.querySelector(".layout_content").scrollTop=0,this.active=t,this.$store.state.tabActive=this.active},formatter:function(t,e){return this.utils.pickerType(t,e)},transformData:function(t){var e=this;return t.forEach(function(t){t.selected=!1,t.traineeMajorText=e.utils.getValueByKey(e.$store.state.majors,t.traineeMajorCode)}),t},formatDate:function(t){var e=t.split("-"),a=Number(e[1]);return 2==a?e[0]%4==0&&e[0]%100==0&&e[0]%400==0?"-29":"-28":1==a||3==a||5==a||7==a||8==a||10==a||12==a?"-31":"-30"},getData:function(t){var e=this,a=this.tabs[this.active];this.currentPage=Math.ceil(a.newList.length/this.$store.state.pageSize),this.currentPage=this.currentPage+1,t&&(this.currentPage=1);var i={currentPage:this.currentPage,pageSize:this.$store.state.pageSize};0==this.active?i.statusList=["2"]:1==this.active&&(i.statusList=["3","4"],i.startTime=this.startTime+"-01",i.endTime=this.startTime+this.formatDate(this.startTime)),this.utils.ajax({url:this.api.queryEntryRegisterList,data:i,method:"POST",success:function(t){1==e.currentPage?a.newList=e.transformData(t.content):a.newList=a.newList.concat(e.transformData(t.content)),0==t.content.length?a.finishedText="":a.finishedText="没有更多了",e.totalElements=t.totalElements,e.totalPages=t.totalPages,a.loading=!1,e.currentPage>=e.totalPages?a.finished=!0:a.finished=!1}},!0)},checkedList:function(){var t=this.tabs[this.active].newList.filter(function(t){return 1==t.selected});return t},entryType:function(t){var e=this.checkedList();if(1==t){if(this.status="4",0==e.length)return void this.Toast("请选择待登记的进行入科登记");this.ajaxUpdateEntryDepartmentStatus()}else if(0==t){if(this.status="3",0==e.length)return void this.Toast("请选择待登记的进行未入科说明");this.descriptShow=!0}},ajaxUpdateEntryDepartmentStatus:function(){var t=this,e={status:this.status,datas:[]};this.checkedList().forEach(function(t,a){e.datas.push({id:t.id,checkInTime:t.startTime})}),this.remark,this.utils.ajax({url:this.api.updateEntryDepartmentStatus,data:e,method:"POST",success:function(e){t.getData(1)}})},conformDate:function(t){this.checkInTime=t,this.checkInTime||this.Toast("请选择报到时间"),this.ajaxUpdateEntryDepartmentStatus(),this.cancleDate()},cancleDate:function(){this.timeShow=!1},beforeClose:function(t,e){if("confirm"==t){if(!this.remark)return this.Toast("请输入未入科说明"),void e(!1);if(this.remark.length>255)return this.Toast("未入科说明不能超过255个字符"),void e(!1);this.ajaxUpdateEntryDepartmentStatus(),this.descriptShow=!1}else"cancel"==t&&(this.descriptShow=!1,this.remark="");e()},timeSelected:function(){this.checkedTimeShow=!0},conformCheckedTime:function(t){this.startTime=this.utils.formatDate(t.getTime(),"yyyy-MM"),this.startTimeShow=this.startTime.replace(/-/g,"/"),this.currentDate=t,this.cancleCheckedDate(),this.getData(1)},cancleCheckedDate:function(){this.checkedTimeShow=!1}},created:function(){this.active=this.$store.state.tabActive}},s={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"entryRegister"},[a("van-nav-bar",{staticClass:"header",attrs:{title:"入科登记",fixed:"","left-arrow":""},on:{"click-left":t.onClickLeft}}),t._v(" "),a("div",{staticClass:"layout_content"},[a("van-tabs",{attrs:{sticky:"","offset-top":40,swipeable:"","title-active-color":"#1a7fe9",color:"#5fa4ec","line-height":2},on:{change:t.change},model:{value:t.active,callback:function(e){t.active=e},expression:"active"}},t._l(t.tabs,function(e,i){return a("div",[a("van-tab",{attrs:{title:e.title}},[1==i?a("div",{staticClass:"entryTime"},[a("van-cell",{attrs:{title:"入科时间","is-link":"",value:t.startTimeShow},on:{click:t.timeSelected}})],1):t._e(),t._v(" "),a("div",{staticClass:"entryRegisterCont"},[a("van-list",{attrs:{finished:e.finished,error:e.error,"error-text":"请求失败，点击重新加载","finished-text":e.finishedText,offset:50},on:{"update:error":function(a){return t.$set(e,"error",a)},load:function(e){return t.onLoad()}},model:{value:e.loading,callback:function(a){t.$set(e,"loading",a)},expression:"item.loading"}},[a("div",{staticClass:"entryRegisterList"},[a("ViewList",{attrs:{listObj:e.listObj,listData:e.newList}})],1)])],1),t._v(" "),0==i?a("footer",{staticClass:"mt"},[a("div",{staticClass:"button"},[a("p",{staticClass:"entry",on:{click:function(e){return t.entryType(1)}}},[t._v("已入科")]),t._v(" "),a("p",{staticClass:"notEntry",on:{click:function(e){return t.entryType(0)}}},[t._v("未入科")])])]):t._e()])],1)}),0),t._v(" "),a("van-popup",{attrs:{position:"bottom"},model:{value:t.timeShow,callback:function(e){t.timeShow=e},expression:"timeShow"}},[a("van-datetime-picker",{attrs:{type:"datetime",formatter:t.formatter},on:{confirm:t.conformDate,cancel:t.cancleDate},model:{value:t.checkInTime,callback:function(e){t.checkInTime=e},expression:"checkInTime"}})],1),t._v(" "),a("van-popup",{attrs:{position:"bottom"},model:{value:t.checkedTimeShow,callback:function(e){t.checkedTimeShow=e},expression:"checkedTimeShow"}},[a("van-datetime-picker",{attrs:{type:"year-month",formatter:t.formatter},on:{confirm:t.conformCheckedTime,cancel:t.cancleCheckedDate},model:{value:t.currentDate,callback:function(e){t.currentDate=e},expression:"currentDate"}})],1),t._v(" "),a("van-dialog",{attrs:{"show-cancel-button":"","before-close":t.beforeClose},model:{value:t.descriptShow,callback:function(e){t.descriptShow=e},expression:"descriptShow"}},[a("p",{staticClass:"title"},[a("strong",{staticClass:"red"},[t._v(" *")]),t._v("未入科说明:")]),t._v(" "),a("div",{staticClass:"descript"},[a("van-field",{attrs:{type:"textarea",placeholder:"未入科说明",autosize:""},model:{value:t.remark,callback:function(e){t.remark="string"==typeof e?e.trim():e},expression:"remark"}})],1)])],1)],1)},staticRenderFns:[]};var n=a("VU/8")(i,s,!1,function(t){a("n6gg")},null,null);e.default=n.exports},n6gg:function(t,e){}});
//# sourceMappingURL=45.53bedb3fee03d2fa46bf.js.map
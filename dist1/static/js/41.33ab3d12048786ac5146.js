webpackJsonp([41],{RPK6:function(t,i,e){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var s=e("mvHQ"),a=e.n(s),n=e("ifoU"),o=e.n(n),l={name:"ActivitiesDetails",data:function(){return{applyList:[],src:[],buttonShow:!1,promptly:"",Sign_up:"",timestamp:"",applying:!1,disabled:!1,disabledCancel:!1,Dontsignup:!1,pbotton:"",pbotton1:"",pbotton2:"",questionnaire:!1,questionnaire1:!1,questionnaire2:!1,feedbackk:!1,placeholder:"建议或意见，不得超过500字",message:"",imgList:[],imgIndexMap:new o.a,locationObj:{locationDetail:"正在获取当前位置",latitudeAndLongitude:""}}},methods:{onClickLeft:function(){this.$store.state.activitiesDetailsObj=null,this.utils.goBack(this)},clickToSign:function(){this.sood()},sood:function(){var t=this;if((this.utils.getTime(this.$store.state.timestamp)-this.utils.getTime(this.applyList.startTime))/36e5<-2)this.Toast("请在活动开始前两小时内打卡");else{this.applyList.id;this.webApp.WebCallApp("CmdScanQrCode",{},function(i){var e=t.utils.getPrams(i);if(t.applyList.id!=e.teachingId)return t.Toast("无效二维码");var s={qrCodeInfoJson:a()(e),memberCaId:t.$store.state.userInfo.human.caId,teachingId:t.applyList.id};t.utils.ajax({url:t.api.saveQrSignInOrSignOut,method:"POST",data:s,success:function(i){t.Toast("打卡成功"),console.log("打卡成功")}})})}},location:function(){var t=this;AMap.plugin("AMap.Geolocation",function(){var i=new AMap.Geolocation({enableHighAccuracy:!0,timeout:5e3,buttonOffset:new AMap.Pixel(10,20)});i.getCurrentPosition(),AMap.event.addListener(i,"complete",function(i){t.locationObj.locationDetail=i.formattedAddress,t.locationObj.latitudeAndLongitude=i.position.lat+","+i.position.lng,t.locationObj.flage=!0}),AMap.event.addListener(i,"error",function(i){t.locationObj.locationDetail="定位失败，请重新获取定位","Geolocation permission denied."===i.message&&(t.Toast("请开启定位权限"),t.locationObj.locationDetail="请开启定位权限"),t.locationObj.flage=!1})})},pageDisplay:function(){"teaching_activity"===this.$store.state.activitiesDetailsObj.condition?(console.log("1"),this.buttonShow=!1,this.Dontsignup=!0,this.getLeaveList(this.$store.state.activitiesDetailsObj.id)):"ToStayIn"===this.$store.state.activitiesDetailsObj.condition&&(console.log("12"),this.buttonShow=!0,this.Dontsignup=!1,this.getLeaveList(this.$store.state.activitiesDetailsObj.id))},getLeaveList:function(t){var i=this,e={id:t,isPrceview:1};this.utils.ajax({url:this.api.activityDetail,data:e,method:"POST",success:function(t){console.log(t,"5555555555555"),t.attachmentList.forEach(function(t,e){i.utils.checkSuffix(t.name)&&(i.imgList.push(t.path),i.imgIndexMap.set(e,i.imgList.length-1))}),i.applyList=t;var e=new Date(i.applyList.startTime).getTime(),s=new Date(i.$store.state.timestamp).getTime(),a=parseInt(2);"ToStayIn"===i.$store.state.activitiesDetailsObj.condition||(0===i.applyList.isSignUp&&(i.Dontsignup=!1),1===i.applyList.isSignUp&&(i.Dontsignup=!0),0===i.applyList.joinFlag&&(i.applying=!0,console.log("需要报名")),1===i.applyList.joinFlag&&(i.applying=!1),2===i.applyList.joinFlag&&(i.applying=!0),console.log(s,"服务器时间"),console.log(e,"活动开始"),console.log(a,"小时"),s+72e5<e&&1===i.applyList.isSignUp&&(i.Dontsignup=!0),s+72e5<e&&0===i.applyList.isSignUp&&(i.Dontsignup=!1),s+72e5>e&&(i.Dontsignup=!1)),console.log(i.applyList.joinFlag,"oooooooooothis.applyList.joinFlag",i.applyList.isSignUp,"ssssssss"),0==i.applyList.isHaveOpinion?(i.pbotton="pbotton",i.questionnaire=!0):1==i.applyList.isHaveOpinion&&(i.pbotton="pbotton1",i.questionnaire=!1),e<s&&(console.log("ksajdlas"),i.pbotton2="pbotton1",i.questionnaire2=!1),e>s&&(i.pbotton2="pbotton",i.questionnaire2=!0)}})},showAttachment:function(t,i){if(this.utils.checkSuffix(t.name))this.utils.imagePreview(this.imgList,this.imgIndexMap.get(i));else if(0==this.utils.isInAndroid())this.Toast("请通过电脑进行查看或下载");else{console.log("调用app下载");var e={name:t.name,url:t.path};this.utils.downLoadFile(e)}},applyingY:function(t,i,e){var s={flag:t,memberId:i,teachingId:e};this.utils.ajax({url:this.api.upOrCancelSignTeaching,data:s,method:"POST",success:function(t){console.log(t,"pqpwpqpw")}})},applyClick:function(){this.applying=!this.applying,console.log(111),this.applyingY(1,this.$store.state.activitiesDetailsObj.memberCaId,this.$store.state.activitiesDetailsObj.id)},cancelClick:function(){this.applying=!this.applying,this.applyingY(2,this.$store.state.activitiesDetailsObj.memberCaId,this.$store.state.activitiesDetailsObj.id)},feedback:function(){this.feedbackk=!0},beforeClose:function(t,i){if("confirm"===t)if(console.log(this.message.length,"12315555555"),""==this.message)this.Toast("内容不能为空!"),i(!1);else if(this.message.length>500)this.Toast("内容不能超过500字!"),i(!1);else{var e={teachingId:this.$store.state.activitiesDetailsObj.id,memberCaId:this.$store.state.activitiesDetailsObj.memberCaId,content:this.message};this.utils.ajax({url:this.api.saveFeedBackForTeaching,data:e,method:"POST",success:function(t){}}),i()}else i()},questionnaireSurvey:function(){this.$router.push({name:"questionnaire",params:{id:this.$store.state.activitiesDetailsObj.id}})}},created:function(){this.pageDisplay(),console.log("ididididi",this.$store.state.activitiesDetailsObj.memberCaId)}},c={render:function(){var t=this,i=t.$createElement,e=t._self._c||i;return e("div",[e("van-nav-bar",{staticClass:"header",attrs:{title:"活动详情",fixed:"","left-arrow":""},on:{"click-left":t.onClickLeft}}),t._v(" "),e("div",{staticClass:"layout_content"},[e("div",[e("div",{staticClass:"heade"},[e("ul",{staticClass:"heade_top"},[e("li",[e("h3",[t._v(t._s(t.applyList.title))])]),t._v(" "),e("li",[e("p",[t._v("活动时间：")]),t._v(" "),e("p",{staticClass:"p"},[t._v(t._s(t.applyList.startTime)+" - "+t._s(t.applyList.endTime))])]),t._v(" "),e("li",[e("p",[t._v("主讲人：")]),t._v(" "),e("p",[t._v(t._s(t.applyList.speaker))])]),t._v(" "),e("li",[e("p",[t._v("活动地点：")]),t._v(" "),e("p",[t._v(t._s(t.applyList.locationOfTeaching))])]),t._v(" "),e("li",[e("p",[t._v("报名人数：")]),t._v(" "),e("p",[t._v(t._s(t.applyList.numOfSignUp))])])])]),t._v(" "),e("div",{staticClass:"background"},[e("ul",[t._m(0),t._v(" "),e("li",[e("p",{domProps:{innerHTML:t._s(t.applyList.detail)}})]),t._v(" "),e("li",t._l(t.applyList.attachmentList,function(i,s){return e("div",{staticClass:"pwith"},[e("p",{on:{click:function(e){return t.showAttachment(i,s)}}},[t._v(t._s(i.name))])])}),0)])])]),t._v(" "),t.buttonShow?e("div",{staticClass:"bottom"},[e("button",{class:t.pbotton,attrs:{disabled:t.questionnaire},on:{click:function(i){return t.questionnaireSurvey()}}},[t._v("问卷调查")]),t._v(" "),e("button",{staticClass:"pbotton1",on:{click:t.clickToSign}},[t._v("扫码打卡")]),t._v(" "),e("button",{class:t.pbotton2,attrs:{disabled:t.questionnaire2},on:{click:function(i){return t.feedback()}}},[t._v("意见反馈")])]):t._e(),t._v(" "),e("van-dialog",{attrs:{title:"意见反馈","show-cancel-button":"","confirm-button-text":"提交","before-close":t.beforeClose},model:{value:t.feedbackk,callback:function(i){t.feedbackk=i},expression:"feedbackk"}},[e("van-cell-group",[e("van-field",{attrs:{type:"textarea",placeholder:t.placeholder,maxlength:"500",rows:"1",autosize:""},model:{value:t.message,callback:function(i){t.message=i},expression:"message"}})],1)],1),t._v(" "),t.Dontsignup?e("div",[e("div",{staticClass:"bottom"},[t.applying?e("button",{staticClass:"Sign_up",attrs:{disabled:t.disabled},on:{click:function(i){return t.applyClick()}}},[t._v("立即报名")]):t._e(),t._v(" "),t.applying?t._e():e("button",{staticClass:"cancel",attrs:{disabled:t.disabled},on:{click:function(i){return t.cancelClick()}}},[t._v("取消报名")])])]):t._e()],1)],1)},staticRenderFns:[function(){var t=this.$createElement,i=this._self._c||t;return i("li",[i("h3",[this._v("活动详情")])])}]};var p=e("VU/8")(l,c,!1,function(t){e("kTeo")},"data-v-27547e5e",null);i.default=p.exports},kTeo:function(t,i){}});
//# sourceMappingURL=41.33ab3d12048786ac5146.js.map
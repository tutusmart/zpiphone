webpackJsonp([9],{"500Y":function(t,e,i){"use strict";var a={name:"Retroactive",components:{},props:["retroactive"],data:function(){var t=this.utils.formatDate((new Date).getTime(),"yyyy-MM-dd").replace(/-/g,"/"),e=this.utils.formatDate(t,"yyyy-MM-dd");return{listData:this.retroactive,currentSignInDate:new Date,currentSignOutDate:new Date,dateTime:t,showSignIn:!1,showSignOut:!1,type:"",signTime:e,signInTime:"",signInTimeText:"",signOutTime:"",signOutTimeText:"",currentId:"",index:0}},created:function(){},methods:{dateClick:function(){this.show=!0,this.type=1},isDate:function(t){var e=new Date(t),i=e.getMonth()+1;!this.dateTime&&(this.dateTime=e.getFullYear()+"/"+i+"/"+e.getDay())},confirm:function(t){this.utils.formatDate(t.getTime(),"yyyy-MM-dd").replace(/-/g,"/");var e=this.utils.formatDate(t.getTime()),i=this.utils.formatDate(t.getTime()).replace(/-/g,"/");if(2==this.type){if(this.retroactive[this.index].signOutTime)if(!this.valiteSign(e,this.retroactive[this.index].signOutTime))return;this.showSignIn=!1,this.retroactive[this.index].signInTime=e,this.retroactive[this.index].signInTimeText=i,this.confirmBackDailySign()}else if(3==this.type){if(this.retroactive[this.index].signInTime)if(!this.valiteSign(this.retroactive[this.index].signInTime,e))return;this.showSignOut=!1,this.retroactive[this.index].signOutTime=e,this.retroactive[this.index].signOutTimeText=i,this.confirmBackDailySign()}},confirmBackDailySign:function(){var t=this,e=null,i=this;if(this.retroactive.forEach(function(a,n){a.signInTime&&a.signOutTime&&t.utils.getTime(a.signInTime)<t.utils.getTime(a.signOutTime)&&(e=a,i.index=n)}),e){var a={ids:[e.id],signInTime:e.signInTime,signOutTime:e.signOutTime};this.backDailySign(a)}},valiteSign:function(t,e){var i=!0;return t>=e?(this.Toast("签到时间不能大于签退时间"),i=!1):i},backDailySign:function(t){var e=this;this.utils.ajax({url:this.api.backDailySign,data:t,method:"POST",success:function(t){e.retroactive.splice(e.index,1),e.Toast("补签成功")}},!1)},formatter:function(t,e){return this.utils.pickerType(t,e)},cancel:function(){1==this.type?this.show=!1:2==this.type?this.showSignIn=!1:3==this.type&&(this.showSignOut=!1)},signindate:function(t,e,i){this.index=t,"sign"===e&&(this.showSignIn=!0,this.type=2,this.currentId=i.id),"signOut"===e&&(this.showSignOut=!0,this.type=3,this.currentId=i.id)}}},n={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{},[t._l(t.retroactive,function(e,a){return i("div",[i("div",{staticClass:"bottom"},[i("div",{staticClass:"surface"},[i("ul",[i("li",[i("p",[t._v("姓名：")]),t._v(" "),i("p",[t._v(t._s(e.studentName))])]),t._v(" "),i("li",[i("p",[t._v("班次：")]),t._v(" "),i("p",[t._v(t._s(e.typeName))])]),t._v(" "),i("li",[i("p",[t._v("轮转科室：")]),t._v(" "),i("p",[t._v(t._s(e.departmentName))])])])]),t._v(" "),i("div",{staticClass:"SignInButton"},[i("ul",{staticClass:"timeButton"},[i("li",[i("div",{staticClass:"signText"},[i("p",{staticClass:"p",class:{gray:e.signInTime},on:{click:function(i){return t.signindate(a,"sign",e)}}},[t._v("签到时间")]),t._v(" "),i("p",[t._v(t._s(e.signInTime))])])]),t._v(" "),i("li",[i("div",{staticClass:"signText"},[i("p",{staticClass:"p",class:{gray:e.signOutTime},on:{click:function(i){return t.signindate(a,"signOut",e)}}},[t._v("签退时间")]),t._v(" "),i("p",[t._v(t._s(e.signOutTime))])])])])])])])}),t._v(" "),i("van-popup",{attrs:{position:"bottom",overlay:!0},model:{value:t.showSignIn,callback:function(e){t.showSignIn=e},expression:"showSignIn"}},[i("van-datetime-picker",{attrs:{type:"datetime",formatter:t.formatter},on:{confirm:t.confirm,cancel:t.cancel},model:{value:t.currentSignInDate,callback:function(e){t.currentSignInDate=e},expression:"currentSignInDate"}})],1),t._v(" "),i("van-popup",{attrs:{position:"bottom",overlay:!0},model:{value:t.showSignOut,callback:function(e){t.showSignOut=e},expression:"showSignOut"}},[i("van-datetime-picker",{attrs:{type:"datetime",formatter:t.formatter},on:{confirm:t.confirm,cancel:t.cancel},model:{value:t.currentSignOutDate,callback:function(e){t.currentSignOutDate=e},expression:"currentSignOutDate"}})],1)],2)},staticRenderFns:[]};var s=i("VU/8")(a,n,!1,function(t){i("mJg1")},"data-v-426773df",null);e.a=s.exports},"eaW/":function(t,e){},mJg1:function(t,e){},rW0I:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=i("Gu7T"),n=i.n(a),s=i("p2g1"),r=i("eu7k"),o={name:"SubjectAppraise",components:{Retroactive:i("500Y").a,ViewList:s.a,PassAndNoPass:r.a},data:function(){return{error:"请选择待审核数据",active:0,calendarShow:!1,auditDate:new Date,currentDate:new Date,tabs:[{title:"待审核",loading:!1,finished:!1,error:!1,selected:!1,finishedText:"没有更多了",scrollTop:0,listObj:{list:[{field:"姓名：",name:"name",leftClass:"gray",render:function(t,e){return t.student.name}},{field:"轮转科室：",name:"departmentName",leftClass:"gray",render:function(t,e){return t.departmentName}},{field:"申请日期：",name:"applyDate",leftClass:"gray"}],click:this.viewAppraise},listData:[]},{title:"已审核",loading:!1,finished:!1,error:!1,finishedText:"没有更多了",scrollTop:0,listObj:{list:[{field:"姓名：",name:"name",leftClass:"gray",render:function(t,e){return t.student.name}},{field:"轮转科室：",name:"departmentName",leftClass:"gray"},{field:"申请人：",name:"memberName",leftClass:"gray"},{field:"审核状态：",name:"auditFlag",leftClass:"gray",render:function(t,e){return 1==t.auditFlag?'<span class="green">审核通过</span>':2==t.auditFlag?'<span class="red">审核不通过</span>':void 0}},{field:"审核意见：",name:"auditOpinion",leftClass:"gray"},{field:"审核日期：",name:"auditDate",leftClass:"gray"}]},listData:[]}]}},methods:{onClickLeft:function(){this.utils.goBack(this)},onLoad:function(){this.queryData()},change:function(t,e){var i=this;this.$nextTick(function(){i.$refs.layoutContent.scrollTop=i.tabs[i.active].scrollTop})},scroll:function(){this.tabs[this.active].scrollTop=this.$refs.layoutContent.scrollTop},selectTime:function(){this.calendarShow=!0},selectDate:function(t){var e=t.getFullYear(),i=(t.getMonth()+1).toString();i=1===i.length?"0"+i:i,this.tabs[this.active].listData=[],this.auditDate=e+"-"+i,this.calendarShow=!1,this.queryData()},closePopup:function(){this.calendarShow=!1},formatter:function(t,e){return this.utils.pickerType(t,e)},queryData:function(t){var e=this.tabs[this.active],i={currentPage:t||Math.ceil(e.listData.length/this.$store.state.pageSize)+1,pageSize:this.$store.state.pageSize};switch(this.active){case 0:i.auditFlags=[0];break;case 1:i.auditDate=this.auditDate,i.auditFlags=[1,2];break;default:return}this.utils.ajax({method:"post",data:i,url:this.api.getNotAlreadyAuditDepartmentOutApply,success:function(a){a.content.length?a.content.forEach(function(t){t.selected=!1}):e.finishedText="",e.listData=t?a.content:[].concat(n()(e.listData),n()(a.content)),e.loading=!1,i.currentPage>=a.totalPages?e.finished=!0:e.finished=!1,console.log(a.content)}})},viewAppraise:function(t){t.selected=!t.selected},givenAudit:function(t){var e=this,i=[],a=this.tabs[this.active];a.listData.forEach(function(t){t.selected&&i.push(t.id)});var n="pass"==t.type?this.api.approval:this.api.reject;this.utils.ajax({method:"post",data:{auditOpinion:t.data,ids:i},url:n,success:function(i){"pass"==t.type?e.Toast("审核通过"):e.Toast("审核不通过"),setTimeout(function(){e.queryData(1)},500)},error:function(t){a.loading=!1,a.error=!0}})}},created:function(){this.auditDate=this.utils.formatDate(this.$store.state.timestamp||(new Date).getTime(),"yyyy-MM")}},c={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("van-nav-bar",{staticClass:"header",attrs:{title:"审核出科",fixed:"","left-arrow":""},on:{"click-left":t.onClickLeft}}),t._v(" "),i("div",{ref:"layoutContent",staticClass:"layout_content",on:{scroll:function(e){return t.scroll()}}},[i("van-tabs",{attrs:{"offset-top":40,sticky:"",swipeable:"","title-active-color":"#1a7fe9",color:"#5fa4ec","line-height":2},on:{click:t.change,change:t.change},model:{value:t.active,callback:function(e){t.active=e},expression:"active"}},t._l(t.tabs,function(e,a){return i("div",[i("van-tab",{attrs:{title:e.title}},[i("van-list",{attrs:{finished:e.finished,error:e.error,"error-text":"请求失败，点击重新加载","finished-text":e.finishedText,"immediate-check":"",offset:50},on:{"update:error":function(i){return t.$set(e,"error",i)},load:function(e){return t.onLoad()}},model:{value:e.loading,callback:function(i){t.$set(e,"loading",i)},expression:"item.loading"}},[1==a?i("div",{staticClass:"auditDate"},[i("van-cell",{attrs:{title:"审核日期","is-link":"",value:t.auditDate},on:{click:function(e){return t.selectTime()}}})],1):t._e(),t._v(" "),i("ViewList",{attrs:{listObj:e.listObj,listData:e.listData}})],1)],1)],1)}),0),t._v(" "),0==t.active?i("PassAndNoPass",{class:0==t.active?"mt":"",attrs:{error:t.error,list:t.tabs[0].listData},on:{auditHandle:t.givenAudit}}):t._e(),t._v(" "),i("van-popup",{attrs:{position:"bottom"},model:{value:t.calendarShow,callback:function(e){t.calendarShow=e},expression:"calendarShow"}},[i("van-datetime-picker",{attrs:{type:"year-month",formatter:t.formatter},on:{confirm:t.selectDate,cancel:t.closePopup},model:{value:t.currentDate,callback:function(e){t.currentDate=e},expression:"currentDate"}})],1)],1)],1)},staticRenderFns:[]};var l=i("VU/8")(o,c,!1,function(t){i("eaW/")},"data-v-6291bbe7",null);e.default=l.exports}});
//# sourceMappingURL=9.de9b5f225dd577c7b315.js.map